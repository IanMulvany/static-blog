<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

    
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>save mailfolder messages to a file using applescript - 's Blog</title>
   <meta name="author" content="" />
   <meta name="google-site-verification" content="kcwqSOIUD45pdwQpCs4vO0hiOumWyJ42j_zp4Oc1eHE" />
   <link rel='me' href='http://www.google.com/profiles/ian.mulvany'>
   <link rel="alternate" type="application/rss+xml" title="partially attended" href="http://partiallyattended.com/atom.xml"/>
   <!-- <link href="http://feeds.feedburner.com/hackerific" rel="alternate" title="Matt Foster" type="application/atom+xml" /> -->

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/app-ca19faaa3640e3ac64195a971a3f3ffd.css">
    <link rel="stylesheet" href="/assets/jasny-bootstrap.min-1f13627da40baafa46480927e9ed7c4f.css">
    <link rel="stylesheet" href="/assets/navmenu-push-48912be81fe1965cbda92ab1404e600b.css">
    <link rel="stylesheet" href="/assets/fluidbox-e2af55dd5c3fecf7aea657fff65eec3f.css">

</head>


<body>


<div class="site">

    <div class="container">



        <div class="row">
          <div class="col-md-8 col-md-offset-2">
            <div class="page-header">
                <div class="title">
    <a class = "banner" href="/">partially-attended</a>
    <a class="extra" href="/">home</a>
    <a class="extra" href="/tags.html">tags</a>
    <a class="extra" href="/about.html">about</a>
  </div>

            </div>
          </div>
        </div>

        <div class="content">
          <div class="row">
            <div class="col-md-8 col-md-offset-2">
              <h1>save mailfolder messages to a file using applescript</h1>

<p class="info">Posted on: 18 October 2010

in 
  <a href="/tags.html#apple">apple</a>,

  <a href="/tags.html#mail">mail</a>,

  <a href="/tags.html#applescript">applescript</a>


</p>

<div id="post">
<p>I’ll just start by explaining that I hate applescript. I wanted to create a script that would take a specific folder withing the script and save each message from that folder to a text file on my machine for post-processing.</p>

<p>This is what I came up with.</p>

<div class="highlight"><pre><code class="language-applescript" data-lang="applescript"><span class="k">set</span> <span class="nv">fileRoot</span> <span class="k">to</span> <span class="s2">&quot;Macintosh HD:Users:path:&quot;</span>
<span class="k">set</span> <span class="nv">messageList</span> <span class="k">to</span> <span class="p">{}</span>
<span class="k">tell</span> <span class="nb">application</span> <span class="s2">&quot;Mail&quot;</span>
	<span class="k">set</span> <span class="nv">messageList</span> <span class="k">to</span> <span class="nv">messageList</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nv">messages</span> <span class="k">of</span> <span class="nv">mailbox</span> <span class="s2">&quot;mailbox name&quot;</span> <span class="k">of</span> <span class="nv">account</span> <span class="s2">&quot;account&quot;</span> <span class="k">of</span> <span class="nb">application</span> <span class="s2">&quot;Mail&quot;</span><span class="p">)</span>
	<span class="k">set</span> <span class="nv">counter</span> <span class="k">to</span> <span class="mi">1</span>
	<span class="k">repeat</span> <span class="nv">with</span> <span class="nv">theMessage</span> <span class="k">in</span> <span class="nv">messageList</span>
		<span class="k">set</span> <span class="nv">fileNum</span> <span class="k">to</span> <span class="nv">counter</span> <span class="k">as </span><span class="nc">string</span>
		<span class="k">set</span> <span class="nv">theFilePath</span> <span class="k">to</span> <span class="nv">fileRoot</span> <span class="o">&amp;</span> <span class="s2">&quot;mailcontent&quot;</span> <span class="o">&amp;</span> <span class="nv">fileNum</span> <span class="o">&amp;</span> <span class="s2">&quot;.txt&quot;</span>
		<span class="k">set</span> <span class="nv">p</span> <span class="k">to</span> <span class="nv">POSIX</span> <span class="na">path</span> <span class="k">of</span> <span class="nv">theFilePath</span>
		<span class="nb">do shell script</span> <span class="s2">&quot;touch &quot;</span> <span class="o">&amp;</span> <span class="nv">p</span>
		<span class="k">set</span> <span class="nv">theFileReference</span> <span class="k">to</span> <span class="nb">open for access</span> <span class="nv">theFilePath</span> <span class="nv">with</span> <span class="nb">write</span> <span class="nv">permission</span>
		<span class="k">set</span> <span class="nv">messageText</span> <span class="k">to</span> <span class="na">content</span> <span class="k">of</span> <span class="nv">theMessage</span> <span class="k">as </span><span class="nc">string</span>
		<span class="k">set</span> <span class="nv">sent</span> <span class="k">to</span> <span class="nv">date</span> <span class="nv">sent</span> <span class="k">of</span> <span class="nv">theMessage</span> <span class="k">as </span><span class="nc">string</span>
		<span class="nb">write</span> <span class="nv">sent</span> <span class="k">to</span> <span class="nv">theFileReference</span> <span class="nv">starting</span> <span class="nb">at</span> <span class="nv">eof</span>
		<span class="nb">write</span> <span class="s2">&quot;\n&quot;</span> <span class="k">to</span> <span class="nv">theFileReference</span> <span class="nv">starting</span> <span class="nb">at</span> <span class="nv">eof</span>
		<span class="nb">write</span> <span class="nv">messageText</span> <span class="k">to</span> <span class="nv">theFileReference</span> <span class="nv">starting</span> <span class="nb">at</span> <span class="nv">eof</span>
		<span class="nb">close access</span> <span class="nv">theFileReference</span>
		<span class="k">set</span> <span class="nv">counter</span> <span class="k">to</span> <span class="nv">counter</span> <span class="o">+</span> <span class="mi">1</span>
	<span class="k">end</span> <span class="k">repeat</span>
<span class="k">end</span> <span class="k">tell</span></code></pre></div>

<p>It breaks down like this, the following script sets a list to be the messages in our names mailbox folder. We can then iterate over that array, getting attributes of each message, such as the message content or the sent date of the message:</p>

<div class="highlight"><pre><code class="language-applescript" data-lang="applescript"><span class="k">set</span> <span class="nv">messageList</span> <span class="k">to</span> <span class="p">{}</span>
<span class="k">tell</span> <span class="nb">application</span> <span class="s2">&quot;Mail&quot;</span>
	<span class="k">set</span> <span class="nv">messageList</span> <span class="k">to</span> <span class="nv">messageList</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nv">messages</span> <span class="k">of</span> <span class="nv">mailbox</span> <span class="s2">&quot;mailbox name&quot;</span> <span class="k">of</span> <span class="nv">account</span> <span class="s2">&quot;account&quot;</span> <span class="k">of</span> <span class="nb">application</span> <span class="s2">&quot;Mail&quot;</span><span class="p">)</span>
	<span class="k">repeat</span> <span class="nv">with</span> <span class="nv">theMessage</span> <span class="k">in</span> <span class="nv">messageList</span>
		<span class="k">set</span> <span class="nv">messageText</span> <span class="k">to</span> <span class="na">content</span> <span class="k">of</span> <span class="nv">theMessage</span> <span class="k">as </span><span class="nc">string</span>
		<span class="k">set</span> <span class="nv">sent</span> <span class="k">to</span> <span class="nv">date</span> <span class="nv">sent</span> <span class="k">of</span> <span class="nv">theMessage</span> <span class="k">as </span><span class="nc">string</span>
	<span class="k">end</span> <span class="k">repeat</span>
<span class="k">end</span> <span class="k">tell</span></code></pre></div>

<p>Taking the creation of the file root out of the loop, and also adding a looping variable out of the loop the content inside the loop now looks like:</p>

<div class="highlight"><pre><code class="language-applescript" data-lang="applescript"><span class="k">set</span> <span class="nv">fileNum</span> <span class="k">to</span> <span class="nv">counter</span> <span class="k">as </span><span class="nc">string</span>
<span class="k">set</span> <span class="nv">theFilePath</span> <span class="k">to</span> <span class="nv">fileRoot</span> <span class="o">&amp;</span> <span class="s2">&quot;mailcontent&quot;</span> <span class="o">&amp;</span> <span class="nv">fileNum</span> <span class="o">&amp;</span> <span class="s2">&quot;.txt&quot;</span>
<span class="k">set</span> <span class="nv">p</span> <span class="k">to</span> <span class="nv">POSIX</span> <span class="na">path</span> <span class="k">of</span> <span class="nv">theFilePath</span>
<span class="nb">do shell script</span> <span class="s2">&quot;touch &quot;</span> <span class="o">&amp;</span> <span class="nv">p</span>
<span class="k">set</span> <span class="nv">theFileReference</span> <span class="k">to</span> <span class="nb">open for access</span> <span class="nv">theFilePath</span> <span class="nv">with</span> <span class="nb">write</span> <span class="nv">permission</span>
<span class="k">set</span> <span class="nv">messageText</span> <span class="k">to</span> <span class="na">content</span> <span class="k">of</span> <span class="nv">theMessage</span> <span class="k">as </span><span class="nc">string</span>
<span class="k">set</span> <span class="nv">sent</span> <span class="k">to</span> <span class="nv">date</span> <span class="nv">sent</span> <span class="k">of</span> <span class="nv">theMessage</span> <span class="k">as </span><span class="nc">string</span>
<span class="nb">write</span> <span class="nv">sent</span> <span class="k">to</span> <span class="nv">theFileReference</span> <span class="nv">starting</span> <span class="nb">at</span> <span class="nv">eof</span>
<span class="nb">write</span> <span class="s2">&quot;\n&quot;</span> <span class="k">to</span> <span class="nv">theFileReference</span> <span class="nv">starting</span> <span class="nb">at</span> <span class="nv">eof</span>
<span class="nb">write</span> <span class="nv">messageText</span> <span class="k">to</span> <span class="nv">theFileReference</span> <span class="nv">starting</span> <span class="nb">at</span> <span class="nv">eof</span>
<span class="nb">close access</span> <span class="nv">theFileReference</span>
<span class="k">set</span> <span class="nv">counter</span> <span class="k">to</span> <span class="nv">counter</span> <span class="o">+</span> <span class="mi">1</span></code></pre></div>

<p>Looking in a bit more detail, we convert the counter (an int) into a string. We set the filepath to a base filename, the string version of the counter, and a file extension.  In order to ensure that the file exists we pass this path to a shell script, and “touch” the file. That’s right, in order not to get fucked over by applescripts error handling, I’ve just called out to the system shell as the most useful way of creating a filehandler to a file that might not extist. Jesus.</p>

<div class="highlight"><pre><code class="language-applescript" data-lang="applescript"><span class="k">set</span> <span class="nv">fileNum</span> <span class="k">to</span> <span class="nv">counter</span> <span class="k">as </span><span class="nc">string</span>
<span class="k">set</span> <span class="nv">theFilePath</span> <span class="k">to</span> <span class="nv">fileRoot</span> <span class="o">&amp;</span> <span class="s2">&quot;mailcontent&quot;</span> <span class="o">&amp;</span> <span class="nv">fileNum</span> <span class="o">&amp;</span> <span class="s2">&quot;.txt&quot;</span>
<span class="k">set</span> <span class="nv">p</span> <span class="k">to</span> <span class="nv">POSIX</span> <span class="na">path</span> <span class="k">of</span> <span class="nv">theFilePath</span>
<span class="nb">do shell script</span> <span class="s2">&quot;touch &quot;</span> <span class="o">&amp;</span> <span class="nv">p</span></code></pre></div>

<p>The second part of the loop now creates the file handler, writes some of the properties of the mail message into the file, closes the file handler, and iterates our loop counter.</p>

<div class="highlight"><pre><code class="language-applescript" data-lang="applescript"><span class="k">set</span> <span class="nv">theFileReference</span> <span class="k">to</span> <span class="nb">open for access</span> <span class="nv">theFilePath</span> <span class="nv">with</span> <span class="nb">write</span> <span class="nv">permission</span>
<span class="k">set</span> <span class="nv">messageText</span> <span class="k">to</span> <span class="na">content</span> <span class="k">of</span> <span class="nv">theMessage</span> <span class="k">as </span><span class="nc">string</span>
<span class="k">set</span> <span class="nv">sent</span> <span class="k">to</span> <span class="nv">date</span> <span class="nv">sent</span> <span class="k">of</span> <span class="nv">theMessage</span> <span class="k">as </span><span class="nc">string</span>
<span class="nb">write</span> <span class="nv">sent</span> <span class="k">to</span> <span class="nv">theFileReference</span> <span class="nv">starting</span> <span class="nb">at</span> <span class="nv">eof</span>
<span class="nb">write</span> <span class="s2">&quot;\n&quot;</span> <span class="k">to</span> <span class="nv">theFileReference</span> <span class="nv">starting</span> <span class="nb">at</span> <span class="nv">eof</span>
<span class="nb">write</span> <span class="nv">messageText</span> <span class="k">to</span> <span class="nv">theFileReference</span> <span class="nv">starting</span> <span class="nb">at</span> <span class="nv">eof</span>
<span class="nb">close access</span> <span class="nv">theFileReference</span>
<span class="k">set</span> <span class="nv">counter</span> <span class="k">to</span> <span class="nv">counter</span> <span class="o">+</span> <span class="mi">1</span></code></pre></div>


</div>






  
   

  
   

  
   



<div id="related">





</div>

            </div>
          </div>
        </div>
        <div id="comments" >
<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'partiallyattended'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

     </div>

    <div class="footer">

        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-91067-5', 'auto');
  ga('send', 'pageview');

</script>



        <!-- Fluidbox https://github.com/terrymun/Fluidbox -->
        <script src="/js/js-yaml.min.js"></script>
        <script src="/js/imagesloaded.pkgd.min.js"></script>
        <script src="/js/jquery.fluidbox.min.js"></script>
        <script type='text/javascript'>
          $(function () {
            $("a").fluidbox();
          });
        </script>

        <!-- Bootstrap -->
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="/js/jasny-bootstrap.min.js"></script>

        <!-- MathJax -->
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </div>

</div>


</body>
</html>
